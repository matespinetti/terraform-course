#!/bin/bash
# Install Java 11
sudo dnf update -y
sudo dnf install -y java-11-amazon-corretto

# Create application directory
mkdir -p /home/ec2-user/app3-usermgmt
cd /home/ec2-user/app3-usermgmt

# Download the application using curl (instead of wget)
curl -L -o /home/ec2-user/app3-usermgmt/usermgmt-webapp.war https://github.com/stacksimplify/temp1/releases/download/1.0.0/usermgmt-webapp.war

# Verify download
ls -la /home/ec2-user/app3-usermgmt/usermgmt-webapp.war

# Set database environment variables
export DB_HOSTNAME=${rds_db_endpoint}
export DB_PORT=${rds_db_port}
export DB_NAME=${rds_db_name}
export DB_USERNAME=${rds_db_username}
export DB_PASSWORD=${rds_db_password}

# Start the application
java -jar /home/ec2-user/app3-usermgmt/usermgmt-webapp.war > /home/ec2-user/app3-usermgmt/ums-start